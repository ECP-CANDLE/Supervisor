<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>CANDLE Library User Guide</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}



/* Asciidoc customizations */

a:visited {
  color: gray;
}
h5 {
  font-size: 0.8em;
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article" style="max-width:800px">
<div id="header">
<h1>CANDLE Library User Guide</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>The CANDLE library provides a wrapper class and utility functions, which enable users run their own deep learning code in high performance computers that CANDLE supports. With the current version of CANDLE library, users should be able to run hyperparameter optimization (mlrMBO workflow) or parallel excution (upf workflow). Due to the design of both workflows, users are required to implement certain methods (will be explained in section 1) and modify several config files (section 2). This user guide will provide an overview of structure and explanation of parameters or varaiables as needed.</p></div>
</div>
</div>
<h1 id="_how_to_write_candle_compliant_deep_learning_code">How to write CANDLE compliant deep learning code</h1>
<div class="sect1">
<h2 id="_minimum_requirements">Minimum requirements</h2>
<div class="sectionbody">
<div class="paragraph"><p>The CANDLE requires two methods, <code>initialize_parameters()</code> and <code>run()</code>.</p></div>
<div class="sect2">
<h3 id="_initialize_parameters_method">Initialize_parameters Method</h3>
<div class="paragraph"><p>In <code>initialize_parameters</code> method, we will construct a class and build a parameter set, which will be used inside your deep learning code (run method). We provides some common parameters such as <code>batch_size</code>, <code>epochs</code>, etc. In addition to that, you can construct your own parameters (see Aurgument Specification section below). Finally, the <code>initialize_parameters</code> should return a python dictionary, in this doc, will be called <code>gParameters</code> (global parameters).</p></div>
</div>
<div class="sect2">
<h3 id="_run_method">Run Method</h3>
<div class="paragraph"><p>You can place your deep learning code in <code>run(Dict)</code> method. You can use parameter varaiable like <code>gParameters['batch_size']</code>.</p></div>
<div class="paragraph"><p>We have an <a href="https://github.com/ECP-CANDLE/Candle/blob/library/examples/mnist/mnist_mlp_candle.py">example</a>, that converted a simple MNIST neural net <code>mnist_mlp.py</code> provided by <a href="https://github.com/keras-team/keras/blob/master/examples/mnist_mlp.py">Keras Team</a> into CANDLE compliant form. In this example, you will see how the <code>initialize_parameters</code> method is implemented and how the actual NN code was transplanted in <code>run</code> method.</p></div>
<div class="paragraph"><p>Finally, the <code>run()</code> returns history. This can be omitted for upf workflow, but required for HPO workflow.</p></div>
<div class="listingblock">
<div class="content"></div></div>
<div class="colist arabic"><ol>
<li>
<p>
In next section, we will explain where the common.MNIST class came from.
</p>
</li>
<li>
<p>
initialize_parameters return dictionary
</p>
</li>
<li>
<p>
run method receives parameter dictionary
</p>
</li>
<li>
<p>
returns history object
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_argument_sepcification">Argument Sepcification</h2>
<div class="sectionbody">
<div class="paragraph"><p>In order to take advantage of the CANDLE framework, a model needs to be able to modify its parameters via either reading from the default_model file, or overwriting those parameters via an appropriate command line argument. We standadized frequently used ML keywords, as well as certain other keywords which are used by the CANDLE scripts. We recommend users aware of these arguemtns to avoid conflicts. For these CANDLE built-in command line arguments, please see <a href="https://github.com/ECP-CANDLE/Candle/blob/library/common/default_utils.py">default_utils.py</a></p></div>
<div class="sect2">
<h3 id="_adding_keyword">Adding keyword</h3>
<div class="paragraph"><p>In order to simplify the process of adding keywords, we require the user to provide a list of metadata of how to parse the arugment.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[{
  'name':'shared_nnet_spec', // <b>&lt;1&gt;</b>
  'nargs':'+', // <b>&lt;2&gt;</b>
  'type': int, // <b>&lt;3&gt;</b>
  'help':'network structure of shared layer' // <b>&lt;4&gt;</b>
}, ...]</code></pre>
</div></div>
<div class="colist arabic"><ol>
<li>
<p>
required. Name of parameter.
</p>
</li>
<li>
<p>
optional. The number of command-line arguments.
</p>
</li>
<li>
<p>
required. The type to which the command-line arguments should be converted.
</p>
</li>
<li>
<p>
optional. A brief description of what the argument does.
you can add <code>default</code>, <code>choices</code>, and <code>action</code> as needed.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_building_class">Building Class</h3>
<div class="paragraph"><p>When you have a list of additional paramaters, you need to pass the definition to be parsed. Even though you don&#8217;t have any additional parameters, this is generally recommended, since you can buid your own shared method and build data processing code that will be shared.</p></div>
<div class="paragraph"><p>Please take a look this <a href="https://github.com/ECP-CANDLE/Candle/blob/library/examples/mnist/common.py">example</a>. This is a source of common.MNIST class definition.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>additional_definitions = None
required = None

class MNIST(default_utils.Benchmark):
    def set_locals(self):
        if required is not None:
            self.required = set(required)
        if additional_definitions is not None:
            self.additional_definitions = additional_definitions</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_thead_optimization">Thead Optimization</h3>
<div class="paragraph"><p>Some HPC machines like <code>Theta</code>, the performance will greatly improved if we let CANDLE handles threads. So, it is generally recommended to have code like line 14 to 21 in <a href="https://github.com/ECP-CANDLE/Candle/blob/library/examples/mnist/common.py#L14-L21">this example</a></p></div>
</div>
</div>
</div>
<h1 id="_how_to_run_candle_compliant_code_in_theta">How to run CANDLE compliant code in Theta</h1>
<div class="paragraph"><p>As mentioned above, we offer two different workflows in CANDLE:
Unrolled Parameter File (UPF) and Hyper Parameter Optimization (HPO).
The UPF workflow allows you to run parallel multi-node executions with different parameters,
while HPO workflow evaluates the best value of hyperparameters based on mlrMBO algorithm.</p></div>
<div class="sect1">
<h2 id="_running_upf_on_theta">Running UPF on Theta</h2>
<div class="sectionbody">
<div class="paragraph"><p>Step 1. Checkout Supervisor repo</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git clone https://github.com/ECP-CANDLE/Supervisor.git</code></pre>
</div></div>
<div class="paragraph"><p>Step 2. Move to upf workflow directory</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cd Supervisor/workflow/upf</code></pre>
</div></div>
<div class="paragraph"><p>Step 3. Set Env variables. In <code>test/cfg-sys-1.sh</code>,
you will need to set <code>BENCHMARK_DIR</code> to point the directory that your script locates, and
<code>MODEL_PYTHON_SCRIPT</code> to name the script you want to run</p></div>
<div class="listingblock">
<div class="content">
<pre><code>BENCHMARK_DIR=directory_where_my_script_locates
MODEL_PYTHON_SCRIPT=my_script</code></pre>
</div></div>
<div class="paragraph"><p>Step 4. Set execution plan. Check <code>test/upf-1.txt</code> for parameter configuration and modify as needed.
This file contains multiple number of JSON documents. Each JSON document will contain the command line parameters.
For example,</p></div>
<div class="listingblock">
<div class="content">
<pre><code>{"id": "test0", "epochs": 10}
{"id": "test1", "epochs": 20}</code></pre>
</div></div>
<div class="paragraph"><p>This will invoke two instances, which will run 10 epochs and 20 epochs respectively.</p></div>
<div class="paragraph"><p>Step 5. Submit your job. You will need to set <code>QUEUE</code>, <code>PROJECT</code>, <code>PROCS</code>, and <code>WALLTIME</code>.
You can configure those in <code>cfg-sys-1.sh</code> (see Step 3), set as env variables, or you can provide in your command line (see below).</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export QUEUE=default
$ export PROJECT=myproject
$ export PROCS=3
$ export WALLTIME=01:00:00

$ ./test/upf-1.sh theta upf-1.txt

// or

$ QUEUE=default PROJECT=myproject PROCS=3 WALLTIME=01:00:00 ./test/upf-1.sh theta upf-1.txt</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
<code>QUEUE</code> refers to the system queue name. The Theta machine has <code>default</code>, <code>debug-flat-quad</code>, and <code>debug-cache-quad</code>. For more information, please check <a href="https://www.alcf.anl.gov/user-guides/job-scheduling-policy-xc40-systems#queues">https://www.alcf.anl.gov/user-guides/job-scheduling-policy-xc40-systems#queues</a>
</p>
</li>
<li>
<p>
<code>PROJECT</code> refers to your allocated project name. Please check <a href="https://www.alcf.anl.gov/user-guides/allocations">https://www.alcf.anl.gov/user-guides/allocations</a>, for more detail.
</p>
</li>
<li>
<p>
<code>PROCS</code> is a number of nodes. We recommend adding extra 1 node in addition to the number of executions in your plan. In this example, we set 3 (1 + 2).
</p>
</li>
</ul></div>
<div class="paragraph"><p>Step 6. Check queue status</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ qstat -h user_name -f</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_running_mlrmbo_based_hyperparameters_optimization_hpo_on_theta">Running mlrMBO based Hyperparameters Optimization (HPO) on Theta</h2>
<div class="sectionbody">
<div class="paragraph"><p>Step 1. Checkout Supervisor repo</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ git clone https://github.com/ECP-CANDLE/Supervisor.git</code></pre>
</div></div>
<div class="paragraph"><p>Step 2. Move to mlrMBO workflow directory</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cd Supervisor/workflow/mlrMBO</code></pre>
</div></div>
<div class="paragraph"><p>Step 3. Set Env variables. In <code>test/cfg-sys-1.sh</code>,
you will need to set <code>BENCHMARK_DIR</code> to point the directory that your script locates, and
<code>MODEL_PYTHON_SCRIPT</code> to name the script you want to run</p></div>
<div class="listingblock">
<div class="content">
<pre><code>BENCHMARK_DIR=directory_where_my_script_locates
MODEL_PYTHON_SCRIPT=my_script</code></pre>
</div></div>
<div class="paragraph"><p>Step 4. Config hyper parameters. In this step, we are configuring parameter sets, which we will iteratively evaluate.
For example, you can create <code>workflow/data/mnist.R</code> as below.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>param.set &lt;- makeParamSet(
  makeDiscreteParam("batch_size", values=c(32, 64, 128, 256, 512)),
  makeDiscreteParam("activation", values=c("relu", "sigmoid", "tanh")),
  makeDiscreteParam("optimizer", values=c("adam", "sgd", "rmsprop")),
  makeIntegerParam("epochs", lower=20, upper=20)
)</code></pre>
</div></div>
<div class="paragraph"><p>In this example, we are varying four paramters, <code>batch_size</code>, <code>activation</code>, <code>optimizer</code>, <code>epochs</code>.
Entire parameter space will be 5 x 3 x 3 x 1.</p></div>
<div class="paragraph"><p>After creating this file, we need to point this file.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ export PARAM_SET_FILE=mnist.R</code></pre>
</div></div>
<div class="paragraph"><p>Step 5. Submit your job.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./test/test-1.sh mnist theta</code></pre>
</div></div>
<div class="paragraph"><p>The first argument is MODEL_NAME. If the name is registered in <code>test/cfg-prm-1.sh</code>, it will use the pre-configured parameter file.
Otherwise, CANDLE will use <code>PARAM_SET_FILE</code> we configured in step 4.</p></div>
<div class="paragraph"><p>You can specify the HPO search strategy. As you can see in <code>test/cfg-prm-1.sh</code>, you are able to config <code>PROPOSE_POINTS</code>, <code>MAX_CONCURRENT_EVALUATIONS</code>, <code>MAX_ITERATIONS</code>, <code>MAX_BUDGE</code>, <code>DESIGN_SIZE</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>DESIGN_SIZE</code> is a number of param sets that will evaluate at the beginning of HPO search. In this example, CANDLE will select random 10 param sets out of 45 (see Step 4, for break downs).
</p>
</li>
<li>
<p>
<code>MAX_ITERATIONS</code> is a number of iteration.
</p>
</li>
<li>
<p>
<code>PROPOSE_POINTS</code> is a number of param sets that CANDLE will evaluate in each iteration. So, if <code>MAX_ITERATION=3</code> and <code>PROPOSE_POINTS=5</code>, CANDLE will ended up evaluating 25 params (3 x 5 + 10).
</p>
</li>
<li>
<p>
<code>MAX_BUDGET</code> should be greater than total evaluations. In this example, 45.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2018-04-25 16:15:08 CDT
</div>
</div>
</body>
</html>
